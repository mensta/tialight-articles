---
id: "864"
title: "ガチョウを飼えるアプリ「Desktop Goose」のソースコードをみてみる"
date: "2020-02-01"
image: "/images/2020/02/goose_honk.png"
categories: 
  - "pg"
---

GIGAZINEにて「PC上でいたずら好きなガチョウが飼える無料アプリ」として紹介されていた**「Desktop Goose」**というアプリケーションについて。

Desktop Gooseを起動しておくとガチョウがＰＣの画面上を歩き回ったりイラストが描かれたウィンドウを引っ張ってきたり、ときにはマウスを掴んで移動するというイタズラをします。

https://www.youtube.com/watch?v=EQx6fyrZDWM

とても面白いアプリケーションなのですが、プログラミング好きな私としては、やはりそのソースコードも気になります。

[Desktop Goose 配布ページ](https://samperson.itch.io/desktop-goose)を確認してもソースコードの配布はしていないようだったので試しに「JetBrains dotPeek」に読み込んでみたところ、見事に逆コンパイルできました。

## ソースコードをみてみる

逆コンパイルした結果は以下のようなかんじになりました。

![](/images/2020/02/DesktopGooseSources.png)

言語はC#ですね。

ファイルサイズ的にTheGoose.csが一番大きいのでこれをみてみます。

```
      private static string[] possiblePhrases = new string[6]
      {
        "am goose hjonk",
        "good work",
        "nsfdafdsaafsdjl\r\nasdas       sorry\r\nhard to type withh feet",
        "i cause problems on purpose",
        "\"peace was never an option\"\r\n   -the goose (me)",
        "\r\n\r\n  >o) \r\n    (_>"
      };
```

フレーズを発見しました。これはガチョウがメモ帳に書くメッセージですね。

![](/images/2020/02/goose_notepad.png)

 

メモ帳を勝手に起動して書き込むためのコードは以下のようになっていました。

```
public SimpleTextForm()
{
  this.Width = 200;
  this.Height = 150;
  this.Text = "Goose \"Not-epad\"";
  TextBox textBox = new TextBox();
  textBox.Multiline = true;
  textBox.AcceptsReturn = true;
  textBox.Text = TheGoose.SimpleTextForm.possiblePhrases[TheGoose.SimpleTextForm.textIndices.Next()];
  textBox.Location = new Point(0, 0);
  textBox.Width = this.ClientSize.Width;
  textBox.Height = this.ClientSize.Height - 5;
  textBox.Select(textBox.Text.Length, 0);
  textBox.Font = new Font(textBox.Font.FontFamily, 10f, FontStyle.Regular);
  this.Controls.Add((Control) textBox);
  string str = Environment.SystemDirectory + "\\notepad.exe";
  if (!File.Exists(str))
    return;
  try
  {
    this.Icon = Icon.ExtractAssociatedIcon(str);
    this.ShowIcon = true;
  }　catch　{}
}
```

 

全部紹介するのはコードの量的に難しいのでここまでにしておきます。

自分で「Desktop Goose」のコードを確認してみたい方はdotPeekをダウンロードして逆コンパイルをやってみてください。

## JetBrains dotPeek ダウンロード

![JetBrains dotPeek .NETデコンパイラ](/images/2020/02/dotpeek_pi.png)

### .NETアセンブリをC#にデコンパイル

> dotPeekは、ReSharperのバンドルされたデコンパイラに基づく無料のスタンドアロンツールです。 これは、.NETアセンブリを同等のC#またはILコードに確実にデコンパイルできます。
> 
> このデコンパイラは、ライブラリ (_.dll_)、実行ファイル(_.exe_)、Windowsメタデータファイル (_.winmd_)など、複数の形式をサポートしています。

### デコンパイルしたコードをVisual Studioプロジェクトにエクスポート

> アセンブリをデコンパイルしたらすぐに、Visual Studioプロジェクト(_.csproj_)として保存できます。 これはレガシーアセンブリから失われたソースコードを復元しなければならない場合、潜在的に多くの時間を節約できます。

### ダウンロード

https://www.jetbrains.com/ja-jp/decompiler/

無料で使用できる高機能なツールなので興味のある方は使ってみてください！
